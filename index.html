!DOCTYPE
<style>
body {
    overflow: hidden;
    padding: 0;
    margin: 0;
}

.players {
    height: 200px;
    width: 176.1px;
    border-radius: 10px;
    background: gray;
    /*margin-top: 55px;*/
    top: 245px;
    position: absolute;
}

.player1 {
    text-align: center;
    right: 0px;
    position: absolute;
    /*background-color: red;*/
    z-index: 10;
}

.p1tankbody {
    height: 100%;
    position: absolute;
    left: 0;
}

.p1tankfire {
    /* height: 200px;
    position: relative;
    top: -50px;
    transform: rotate(45deg);
    transform-origin: 52% 78%;*/
    height: 200px;
}

#tankfirediv {
    position: relative;
    display: inline-block;
    /*background: rebeccapurple;*/
    transform-origin: 52% 78%;
    top: -50px;
}

#p1tankfiretop {
    position: absolute;
    display: inline;
    font-size: 42px;
    color: red;
    left: 24px;
    line-height: normal;
    /*background: green;*/
    height: 50px;
    width: 50px;
    visibility: hidden;
}

#p1tankfirebottom {
    position: absolute;
    display: inline;
    font-size: 42px;
    color: red;
    bottom: 12px;
    left: 24px;
    /*background: green;*/
    line-height: normal;
    height: 50px;
    width: 50px;
    visibility: hidden;
}

.player2 {
    left: 0%;
}

.box {
    display: block;
    margin: 0;
    width: 100%;
    line-height: 194px;
    background: blue;
    position: absolute;
    height: 100%;
    left: 0;
    top: 0;
    /*overflow: hidden;*/
    /*     display: flex;
  flex-direction: column;*/
    /*justify-content: center;*/
}

.missile {
    height: 20px;
    width: 20px;
    background: black;
    position: absolute;
    top: 0px;
    left: 0px;
    border-radius: 100%;
    z-index: 20;
}

.right-fire {
    animation: right-fire 1s forwards;
    /*position: relative;*/
    position: absolute;
}

@keyframes right-fire {
    to {
        /*left: 110%;*/
        left: 23.96337890625%;
        top: 0%;
    }
}

.left-fire {
    animation: left-fire 1s forwards;
}

@keyframes left-fire {
    to {
        left: 0%;
    }
}

.up-fire {
    animation: up-fire 1s forwards;
}

@keyframes up-fire {
    to {
        top: 0%;
    }
}

.down-fire {
    animation: down-fire 1s forwards;
}

@keyframes down-fire {
    to {
        top: 100%;
    }
}


/*.haha {
    left: 342px;
    transform: rotate(45deg);
}*/

.checking {
    width: 1px;
    height: 150px;
    background: red;
    left: 542px;
    position: relative;
}
</style>
<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js"></script>
<!-- <button>Start</button> -->
<div id="box" class="box">
    <div class="checking">a</div>
</div>
<script>
const keys = {

    playeronekeys: {
        fire: {
            isPressed: false,
            keyCode: 190, // it is '.' dot button
        },
        right: {
            isPressed: false,
            keyCode: 39,
        },
        up: {
            isPressed: false,
            keyCode: 38,
        },
        down: {
            isPressed: false,
            keyCode: 40,
        },
        left: {
            isPressed: false,
            keyCode: 37,
        }
    },
    playertwokeys: {
        fire: {
            isPressed: false,
            keyCode: 17, // this is control button
        },
        d: {
            isPressed: false,
            keyCode: 68,
        },
        w: {
            isPressed: false,
            keyCode: 87,
        },
        s: {
            isPressed: false,
            keyCode: 83,
        },
        a: {
            isPressed: false,
            keyCode: 65,
        }
    }

}


let box = document.getElementById('box');

class tankmaker {
    constructor(name) {
        this.name = name;
        this.class = 'players';
    }
    AddToHtml() {
        let tank = document.createElement('div');
        tank.setAttribute('id', this.name);
        tank.setAttribute('class', this.class + ' ' + this.name);
        box.appendChild(tank);
    }
}


let p1 = new tankmaker('player1');
p1.AddToHtml();


let p2 = new tankmaker('player2');
p2.AddToHtml();


let player1 = document.getElementById('player1')
let player2 = document.getElementById('player2')
let p1offset = $('#player1').offset();
let p2offset = $('#player2').offset();

let p1img = "<img src='tankbody.png' class='p1tankbody'><div id='tankfirediv'><img src='tankfire.png' class='p1tankfire'><div id='p1tankfiretop'></div><div id='p1tankfirebottom'></div></div>";
player1.innerHTML = p1img;



let xposp1 = 0;
let yposp1 = p1offset.top;
let xposp2 = 0;
let yposp2 = p2offset.top;

var won = false;

var cl = console.log;

let speed = 1;

let p1missileinair = false;

let p2stillalive = true;

// let p1mn = 0;
// if (!won) {

let p1rotate = 0;
let p1tankfirerotate = 0;


setInterval(function() {
    document.onkeydown = function(event) {

        for (var key in keys.playeronekeys) {
            if (keys.playeronekeys[key].keyCode == event.keyCode) {
                keys.playeronekeys[key].isPressed = true;

            }

        }
        if (event.keyCode == 190) {


            p1fire();

        }

        if (event.keyCode == 188) {
            // left rotate
            p1tankfirerotate -= 10;
            $('#tankfirediv').css({
                'transform': 'rotate(' + p1tankfirerotate + 'deg)'
            });

        }

        if (event.keyCode == 191) {
            // right rotate

            p1tankfirerotate += 10;
            $('#tankfirediv').css({
                'transform': 'rotate(' + p1tankfirerotate + 'deg)'
            });
        }

        for (var key in keys.playertwokeys) {
            if (keys.playertwokeys[key].keyCode == event.keyCode) {
                keys.playertwokeys[key].isPressed = true;
            }
        }
    }

    // if (!won) {
    for (var key in keys.playeronekeys) {

        if (keys.playeronekeys.right.isPressed) {
            // if ((xposp2 != xposp1) && (yposp2 != xposp1)) {
            xposp1 -= speed;
            player1.style.right = xposp1 + "px";
            // console.log(xposp1);

            // console.log('okay going on right');

            // }
        }
        if (keys.playeronekeys.left.isPressed) {
            xposp1 += speed;
            player1.style.right = xposp1 + "px";
            // console.log(xposp1);
            // console.log('okay going on l`eft');
        }
        if (keys.playeronekeys.up.isPressed) {
            yposp1 -= speed;
            player1.style.top = yposp1 + "px";
            // console.log(yposp1);
            // console.log('okay going on up');
        }
        if (keys.playeronekeys.down.isPressed) {
            yposp1 += speed;
            player1.style.top = yposp1 + "px";
            // console.log(yposp1);
            // console.log('okay going on down');
        }


        if (keys.playeronekeys.up.isPressed && keys.playeronekeys.right.isPressed) {

            player1.style.transform = "rotate(45deg)";
            p1rotate = 45;
        } else if (keys.playeronekeys.up.isPressed && keys.playeronekeys.left.isPressed) {
            player1.style.transform = "rotate(315deg)";
            p1rotate = 315;
        } else if (keys.playeronekeys.down.isPressed && keys.playeronekeys.left.isPressed) {
            player1.style.transform = "rotate(225deg)";
            p1rotate = 225;
        } else if (keys.playeronekeys.down.isPressed && keys.playeronekeys.right.isPressed) {
            player1.style.transform = "rotate(135deg)";
            p1rotate = 135;
        } else if (keys.playeronekeys.right.isPressed) {
            player1.style.transform = "rotate(90deg)";
            p1rotate = 90;
        } else if (keys.playeronekeys.up.isPressed) {
            player1.style.transform = "rotate(0deg)";
            p1rotate = 0;
        } else if (keys.playeronekeys.down.isPressed) {
            player1.style.transform = "rotate(180deg)";
            p1rotate = 180;
        } else if (keys.playeronekeys.left.isPressed) {
            player1.style.transform = "rotate(270deg)";
            p1rotate = 270;
        }



    }



    for (var key in keys.playertwokeys) {

        if (keys.playertwokeys.d.isPressed) {
            xposp2 += speed;
            player2.style.left = xposp2 + "px";
            // console.log(xposp2);
        }
        if (keys.playertwokeys.a.isPressed) {
            xposp2 -= speed;
            player2.style.left = xposp2 + "px";
            // console.log(xposp2);
        }
        if (keys.playertwokeys.w.isPressed) {
            yposp2 -= speed;
            player2.style.top = yposp2 + "px";
            // console.log(yposp2);
        }
        if (keys.playertwokeys.s.isPressed) {
            yposp2 += speed;
            player2.style.top = yposp2 + "px";
            // console.log(yposp2);
        }
    }
    // }

    document.onkeyup = function(event) {
        for (var key in keys.playeronekeys) {
            if (keys.playeronekeys[key].keyCode == event.keyCode) {
                keys.playeronekeys[key].isPressed = false;
            }
        }
        for (var key in keys.playertwokeys) {
            if (keys.playertwokeys[key].keyCode == event.keyCode) {
                keys.playertwokeys[key].isPressed = false;
            }
        }
    };



}, 20);

let p1fireallow = true;

function p1fire() {

    if (p1fireallow == true) {

        let player1offset = $("#player1").offset();
        let player1height = $("#player1").outerHeight(true);
        let player1width = $("#player1").outerWidth(true);


        let p1tankfireoffset = $(".p1tankfire").offset();

        // console.log(offset.left);

        // console.log('');

        // console.log('the fire is on');

        let fire = document.createElement('div');
        // fire.className = 'missile right-fire p1missile';
        fire.className = 'missile p1missile newfire';

        fire.id = 'p1missile';
        $('body').append(fire);



        $(".p1missile").offset({
            top: $('#p1tankfiretop').offset().top + ($('#p1tankfiretop').outerHeight(true) / 2),
            left: $('#p1tankfiretop').offset().left + ($('#p1tankfiretop').outerWidth(true) / 2)
        });
        // } else {
        //      $(".p1missile").offset({
        //             top: p1tankfireoffset.top + outerHeight,
        //             left: p1tankfireoffset.left
        //         });
        // }

        // p1mn = 1;
        // fire.className = 'missile right-fire';



        let p1newfire = document.querySelector('.newfire');


        let yaxis = parseInt($('.p1missile').css('top'), 10);

        let xaxis = parseInt($('.p1missile').css('left'), 10);
        // setInterval(function() {

        let p1missiletopleft = $('#p1tankfiretop').offset().left
        let p1missiletoptop = $('#p1tankfiretop').offset().top;

        let p1missilebottomleft = $('#p1tankfirebottom').offset().left
        let p1missilebottomtop = $('#p1tankfirebottom').offset().top;
        // console.log('this is firign right now');
        let p1xdiff = p1missiletopleft - p1missilebottomleft;
        let p1ydiff = p1missiletoptop - p1missilebottomtop;

        console.log('x difference: ' + p1xdiff);
        console.log('y difference ' + p1ydiff);




        function fireanimationforp1() {
            yaxis += 1 + (p1ydiff * 0.1);
            xaxis += 1 + (p1xdiff * 0.1);
            p1newfire.style.top = yaxis + 'px';
            p1newfire.style.left = xaxis + 'px';

            requestAnimationFrame(fireanimationforp1);

        }
        fireanimationforp1();

        fire.className = 'missile';
        // }, 15);




        // for (var i = 0; i < 100; i++) {
        // let a = i * 0.1;
        // fire.style.left = a + "px";
        // }
        p1missileinair = true;
        p1fireallow = false;
        // console.log(p1fireallow);
        // console.log($('#player2').outerWidth(true));
    }

    setTimeout(function() {
        p1fireallow = true;
    }, 1000);




}

function p1checkhit() {



    let allp1missile = $('#p1missile');
    let p2width = $('#player2').outerWidth(true);
    let player2offset = $("#player2").offset();

    $('.missile').each(function(index, value) {
        let p1missileoffset = $(value).offset();
        let p1missilewidth = $(value).outerWidth(true);
        if (p1missileinair && p2stillalive) {



            if (
                (
                    (p1missileoffset.left == player2offset.left) ||
                    (
                        ((p1missileoffset.left >= player2offset.left) ||
                            (p1missileoffset.left + p1missilewidth >= player2offset.left)) &&
                        (p1missileoffset.left <= (player2offset.left + p2width))
                    )
                ) &&
                (
                    (p1missileoffset.top == player2offset.top) ||
                    (
                        ((p1missileoffset.top + p1missilewidth) >= player2offset.top) &&
                        ((p1missileoffset.top) <= (player2offset.top + p2width))
                    )
                )
            ) {
                console.log('left' + p1missileoffset.left + ', and this is top:' + p1missileoffset.top);
                // $("*").effect("shake", {"direction":"left","distance":"2","times":"3"}, 500);

                $("#player2").hide("explode", {
                    pieces: 50
                }, 2000).remove();


                this.remove();
                p2stillalive = false;
            }



        }

        if (
            ((p1missileoffset.left) > ($('body').outerWidth(true) + $('body').offset().left)) ||
            ((p1missileoffset.top) > ($('body').outerHeight(true) + $('body').offset().top)) ||
            ((p1missileoffset.top) < ($('body').offset().top) - p1missilewidth) ||
            ((p1missileoffset.left) < ($('body').offset().left) - p1missilewidth)
        )

        {
            this.remove();
        }

    });


}




setInterval(function() {
    p1checkhit();
}, 1);
</script>
